<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/png" href="/setuksaver/icon.png">
    <title>ë©€ê¸€ì„¸ (ë©€í‹° ê¸€ììˆ˜ ì„¸ê¸°)</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        /* ê¸°ë³¸ í°íŠ¸ ë° ì»¤ìŠ¤í…€ ìŠ¤íƒ€ì¼ */
        body {
            font-family: 'Inter', 'Noto Sans KR', sans-serif;
        }

        /* data-status ì†ì„±ì— ë”°ë¥¸ ë™ì  ë°°ê²½ìƒ‰ ë³€í™” */
        .block[data-status="draft"] { background-color: #fee2e2; /* red-100 */ }
        .block[data-status="in-progress"] { background-color: #fef9c3; /* yellow-100 */ }
        .block[data-status="completed"] { background-color: #dcfce7; /* green-100 */ }
        
        .index-item[data-status="draft"] { background-color: #fecaca; /* red-200 */ }
        .index-item[data-status="in-progress"] { background-color: #fef08a; /* yellow-200 */ }
        .index-item[data-status="completed"] { background-color: #bbf7d0; /* green-200 */ }

        /* ìŠ¤í¬ë¡¤ë°” ìŠ¤íƒ€ì¼ (ì„ íƒ ì‚¬í•­) */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f5f9;
        }
        ::-webkit-scrollbar-thumb {
            background: #94a3b8;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #64748b;
        }
    </style>
</head>
<body class="bg-slate-100 text-slate-800">

    <!-- ì£¼ ì»¨í…Œì´ë„ˆ -->
    <div class="max-w-5xl mx-auto p-4 sm:p-6 lg:p-8">
        
        <!-- í—¤ë” -->
        <header class="text-center mb-8">
            <h1 class="text-4xl font-bold text-slate-900">ë©€í‹° ê¸€ììˆ˜ ì„¸ê¸° ğŸ“</h1>
            <p class="text-slate-600 mt-2">ê³¼ëª©ë³„ ì„¸íŠ¹ ë‚´ìš©ì„ íš¨ìœ¨ì ìœ¼ë¡œ ê´€ë¦¬í•˜ê³  ê¸€ì ìˆ˜ë¥¼ í™•ì¸í•˜ì„¸ìš”.</p>
        </header>

        <!-- íƒ­ ì»¨í…Œì´ë„ˆ -->
        <div class="flex justify-center bg-slate-200 rounded-xl p-1 mb-6">
            <button class="tab-button flex-1 py-2 px-4 rounded-lg text-lg font-semibold transition-colors duration-300" data-grade="1">1í•™ë…„</button>
            <button class="tab-button flex-1 py-2 px-4 rounded-lg text-lg font-semibold transition-colors duration-300" data-grade="2">2í•™ë…„</button>
            <button class="tab-button flex-1 py-2 px-4 rounded-lg text-lg font-semibold transition-colors duration-300" data-grade="3">3í•™ë…„</button>
        </div>

        <!-- ì•¡ì…˜ ë²„íŠ¼ ê·¸ë£¹ -->
        <div class="flex flex-wrap justify-center gap-4 mb-4">
            <button id="addBlock" class="flex items-center gap-2 bg-indigo-600 text-white font-semibold py-2 px-5 rounded-lg shadow-md hover:bg-indigo-700 transition-all duration-300 transform hover:scale-105">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
                ê³¼ëª© ì¶”ê°€
            </button>
            <button id="indexShortcut" class="flex items-center gap-2 bg-white text-slate-700 font-semibold py-2 px-5 rounded-lg shadow-md hover:bg-slate-50 transition-all duration-300 border border-slate-300">
                ğŸ”– ì¸ë±ìŠ¤ ë°”ë¡œê°€ê¸°
            </button>
        </div>

        <!-- ì €ì¥ ìƒíƒœ ë©”ì‹œì§€ -->
        <div class="save-status text-center text-green-600 font-medium h-6 mb-4" id="saveStatus"></div>

        <!-- ë¸”ë¡ ì»¨í…Œì´ë„ˆ -->
        <div id="container" class="space-y-6"></div>

        <!-- ì¸ë±ìŠ¤ ì»¨í…Œì´ë„ˆ -->
        <div class="index-container mt-12 p-6 bg-white rounded-2xl shadow-lg">
            <h2 class="text-2xl font-bold mb-4 text-slate-800">ê³¼ëª© ì¸ë±ìŠ¤</h2>
            <div class="index-list flex flex-wrap gap-3" id="indexList"></div>
        </div>
        
        <!-- í‘¸í„° ë° ë°ì´í„° ê´€ë¦¬ -->
        <footer class="text-center mt-12 space-y-4">
            <div class="flex justify-center gap-4">
                <button id="downloadData" class="bg-slate-700 text-white font-semibold py-2 px-4 rounded-lg hover:bg-slate-800 transition-colors">ë°±ì—…</button>
                <button id="uploadDataBtn" class="bg-slate-700 text-white font-semibold py-2 px-4 rounded-lg hover:bg-slate-800 transition-colors">ë°±ì—… íŒŒì¼ ì—…ë¡œë“œ</button>
                <input type="file" id="fileInput" class="hidden">
            </div>
            <div class="warning-message text-sm text-red-600 font-medium">
                ë°ì´í„°ëŠ” ë¸Œë¼ìš°ì €ì— ì €ì¥ë˜ì§€ë§Œ, ë§Œì•½ì„ ìœ„í•´ ê¼­ ë°±ì—…ì„ í•˜ì‹œê¸° ë°”ëë‹ˆë‹¤.
            </div>
             <div class="selection-info fixed left-4 bottom-4 bg-gray-900 bg-opacity-80 text-white text-sm py-2 px-4 rounded-lg shadow-lg z-50" id="selectionInfo">ì„ íƒí•œ ê¸€ì ë°”ì´íŠ¸ ìˆ˜: 0</div>
            <div class="flex justify-center items-center mt-6">
                <img src="https://hits.seeyoufarm.com/api/count/incr/badge.svg?url=https%3A%2F%2Fkimsj5025.github.io%2Fsetuksaver%2F&count_bg=%2364748B&title_bg=%23334155&icon=&icon_color=%23E2E8F0&title=%EB%B0%A9%EB%AC%B8%EC%9E%90+%EC%88%98&edge_flat=true"/>
            </div>
            <p class="text-slate-500 text-sm">made by kimCastleOwner</p>
        </footer>
    </div>

    <!-- ìŠ¤í¬ë¡¤ ë²„íŠ¼ -->
    <div class="scroll-buttons fixed right-5 bottom-5 z-50 flex flex-col gap-3">
        <button id="scrollTop" class="w-12 h-12 rounded-full bg-indigo-600 text-white shadow-lg flex items-center justify-center hover:bg-indigo-700 transition-all transform hover:-translate-y-1">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><path d="M12 19V5M5 12l7-7 7 7"/></svg>
        </button>
        <button id="scrollBottom" class="w-12 h-12 rounded-full bg-indigo-600 text-white shadow-lg flex items-center justify-center hover:bg-indigo-700 transition-all transform hover:translate-y-1">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><path d="M12 5v14M19 12l-7 7-7-7"/></svg>
        </button>
    </div>
    
    <!-- ì‚­ì œ í™•ì¸ ëª¨ë‹¬ -->
    <div id="deleteModal" class="fixed inset-0 bg-gray-900 bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-lg shadow-xl p-8 m-4 max-w-sm w-full">
            <h3 class="text-xl font-bold text-slate-800 mb-4">ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?</h3>
            <p class="text-slate-600 mb-6">ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>
            <div class="flex justify-end gap-4">
                <button id="cancelDelete" class="py-2 px-4 bg-slate-200 text-slate-800 font-semibold rounded-lg hover:bg-slate-300 transition-colors">ì·¨ì†Œ</button>
                <button id="confirmDelete" class="py-2 px-4 bg-red-600 text-white font-semibold rounded-lg hover:bg-red-700 transition-colors">ì‚­ì œ</button>
            </div>
        </div>
    </div>


    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- ì „ì—­ ë³€ìˆ˜ ë° ìƒíƒœ ---
            let currentGrade = '1';
            const gradeData = { '1': [], '2': [], '3': [] };
            let blockToDelete = null; // ì‚­ì œí•  ë¸”ë¡ì„ ì„ì‹œ ì €ì¥

            // --- DOM ìš”ì†Œ ---
            const container = document.getElementById("container");
            const saveStatusEl = document.getElementById('saveStatus');
            const indexListEl = document.getElementById("indexList");
            const selectionInfoEl = document.getElementById('selectionInfo');
            const deleteModal = document.getElementById('deleteModal');
            const confirmDeleteBtn = document.getElementById('confirmDelete');
            const cancelDeleteBtn = document.getElementById('cancelDelete');

            // --- í•¨ìˆ˜ ì •ì˜ ---

            // ì €ì¥ ìƒíƒœ ë©”ì‹œì§€ í‘œì‹œ
            function showSaveStatus(message) {
                saveStatusEl.textContent = message;
                setTimeout(() => saveStatusEl.textContent = '', 1500);
            }

            // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— ë°ì´í„° ì €ì¥
            function saveBlocksToLocalStorage() {
                const blocks = [];
                document.querySelectorAll(".block").forEach(block => {
                    blocks.push({
                        title: block.querySelector(".title-input").value,
                        text: block.querySelector(".text-area").value,
                        status: block.dataset.status,
                        collapsed: block.classList.contains('collapsed')
                    });
                });
                gradeData[currentGrade] = blocks;
                localStorage.setItem("gradeData", JSON.stringify(gradeData));
                localStorage.setItem("lastGrade", currentGrade);
                showSaveStatus('ìë™ ì €ì¥ ì™„ë£Œ!');
                updateIndex();
            }

            // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì—ì„œ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
            function loadBlocksFromLocalStorage() {
                const data = localStorage.getItem("gradeData");
                if (data) {
                    Object.assign(gradeData, JSON.parse(data));
                }
                const lastGrade = localStorage.getItem("lastGrade");
                if (lastGrade) {
                    currentGrade = lastGrade;
                }
                updateActiveTab();
                loadGradeBlocks(currentGrade);
            }
            
            // í˜„ì¬ í•™ë…„ íƒ­ í™œì„±í™”
            function updateActiveTab() {
                document.querySelectorAll(".tab-button").forEach(btn => {
                    if (btn.dataset.grade === currentGrade) {
                        btn.classList.add("bg-white", "text-indigo-600", "shadow");
                        btn.classList.remove("text-slate-700");
                    } else {
                        btn.classList.remove("bg-white", "text-indigo-600", "shadow");
                        btn.classList.add("text-slate-700");
                    }
                });
            }

            // íŠ¹ì • í•™ë…„ ë¸”ë¡ ë¡œë“œ
            function loadGradeBlocks(grade) {
                container.innerHTML = '';
                if (gradeData[grade]) {
                    gradeData[grade].forEach(data => addBlock(data.title, data.text, data.status, data.collapsed, false));
                }
                updateIndex();
            }
            
            // ìƒˆ ë¸”ë¡ ì¶”ê°€
            function addBlock(title = "", text = "", status = "draft", collapsed = false, shouldScroll = true) {
                const block = document.createElement("div");
                block.className = `block p-6 rounded-2xl shadow-lg transition-all duration-300 relative ${collapsed ? 'collapsed' : ''}`;
                block.dataset.status = status;

                const byteSize = new Blob([text]).size;

                block.innerHTML = `
                    <div class="block-header flex justify-between items-start mb-4">
                        <input type="text" placeholder="ê³¼ëª©ëª…" class="title-input text-xl font-bold w-full bg-transparent focus:outline-none" value="${title}">
                        
                        <div class="flex items-center gap-4 ml-4 flex-shrink-0">
                            <div class="status-buttons flex items-center gap-2">
                                <button data-status="draft" class="status-button w-6 h-6 rounded-full bg-red-400 border-2 border-white shadow hover:scale-110 transition-transform" title="ì´ˆì•ˆ"></button>
                                <button data-status="in-progress" class="status-button w-6 h-6 rounded-full bg-yellow-400 border-2 border-white shadow hover:scale-110 transition-transform" title="ìˆ˜ì •ì¤‘"></button>
                                <button data-status="completed" class="status-button w-6 h-6 rounded-full bg-green-400 border-2 border-white shadow hover:scale-110 transition-transform" title="ì™„ë£Œ"></button>
                            </div>
                            <div class="block-actions flex items-center gap-2">
                                <button class="collapse-button p-2 rounded-full bg-slate-200 hover:bg-slate-300 transition-colors">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="transition-transform duration-300 ${collapsed ? 'rotate-180' : ''}">
                                        <polyline points="18 15 12 9 6 15"></polyline>
                                    </svg>
                                </button>
                                <button class="delete-button p-2 rounded-full bg-red-100 text-red-600 hover:bg-red-200 transition-colors">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></svg>
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="content-wrapper overflow-hidden transition-all duration-500 ease-in-out ${collapsed ? 'max-h-0' : 'max-h-screen'}">
                        <textarea placeholder="ì„¸íŠ¹ ë‚´ìš©" class="text-area w-full h-48 p-4 bg-white/50 rounded-lg border-2 border-slate-200 focus:border-indigo-500 focus:ring-indigo-500 focus:outline-none resize-y transition-colors">${text}</textarea>
                        <div class="byte-count text-right text-slate-500 mt-2 font-medium">${byteSize} bytes</div>
                    </div>
                `;

                container.appendChild(block);

                // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì—°ê²°
                const titleInput = block.querySelector(".title-input");
                const textArea = block.querySelector(".text-area");
                const byteCount = block.querySelector(".byte-count");
                const collapseButton = block.querySelector(".collapse-button");
                const deleteButton = block.querySelector(".delete-button");
                const statusButtons = block.querySelectorAll(".status-button");

                titleInput.addEventListener("input", saveBlocksToLocalStorage);
                textArea.addEventListener("input", () => {
                    byteCount.textContent = new Blob([textArea.value]).size + " bytes";
                    saveBlocksToLocalStorage();
                });

                collapseButton.addEventListener("click", () => {
                    block.classList.toggle("collapsed");
                    block.querySelector('.content-wrapper').classList.toggle('max-h-0');
                    block.querySelector('.content-wrapper').classList.toggle('max-h-screen');
                    block.querySelector('.collapse-button svg').classList.toggle('rotate-180');
                    saveBlocksToLocalStorage();
                });

                deleteButton.addEventListener("click", () => {
                    blockToDelete = block;
                    deleteModal.classList.remove('hidden');
                });
                
                statusButtons.forEach(button => {
                    button.addEventListener("click", () => {
                        block.dataset.status = button.dataset.status;
                        saveBlocksToLocalStorage();
                    });
                });

                if (shouldScroll) {
                    block.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }
                updateIndex();
            }

            // ì¸ë±ìŠ¤ ì—…ë°ì´íŠ¸
            function updateIndex() {
                indexListEl.innerHTML = '';
                document.querySelectorAll(".block").forEach(block => {
                    const title = block.querySelector(".title-input").value.trim();
                    if (title) {
                        const status = block.dataset.status;
                        const item = document.createElement("div");
                        item.className = "index-item text-sm font-semibold py-2 px-4 rounded-full cursor-pointer hover:scale-105 transition-transform";
                        item.dataset.status = status;
                        item.textContent = title;
                        item.addEventListener('click', () => {
                            block.scrollIntoView({ behavior: 'smooth', block: 'center' });
                            block.classList.remove('collapsed');
                            block.querySelector('.content-wrapper').classList.remove('max-h-0');
                            block.querySelector('.content-wrapper').classList.add('max-h-screen');
                            block.querySelector('.collapse-button svg').classList.remove('rotate-180');
                        });
                        indexListEl.appendChild(item);
                    }
                });
            }

            // ë°ì´í„° ë‹¤ìš´ë¡œë“œ
            function downloadData() {
                const dataStr = JSON.stringify(gradeData, null, 2); // ë³´ê¸° ì¢‹ê²Œ í¬ë§·íŒ…
                const dataBlob = new Blob([dataStr], { type: 'application/json' });
                const url = URL.createObjectURL(dataBlob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `setuk_backup_${new Date().toISOString().slice(0,10)}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            }

            // ë°ì´í„° ì—…ë¡œë“œ
            function uploadData(event) {
                const file = event.target.files[0];
                if (!file) return;
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const data = JSON.parse(e.target.result);
                        // ë°ì´í„° ìœ íš¨ì„± ê²€ì‚¬ (ê°„ë‹¨í•˜ê²Œ)
                        if (data['1'] && data['2'] && data['3']) {
                            Object.assign(gradeData, data);
                            loadGradeBlocks(currentGrade);
                            saveBlocksToLocalStorage();
                            alert('ë°±ì—… ë°ì´í„° ë³µì›ì— ì„±ê³µí–ˆìŠµë‹ˆë‹¤.');
                        } else {
                            alert('ìœ íš¨í•˜ì§€ ì•Šì€ ë°±ì—… íŒŒì¼ì…ë‹ˆë‹¤.');
                        }
                    } catch (error) {
                        alert('íŒŒì¼ì„ ì½ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                        console.error("Upload error:", error);
                    }
                };
                reader.readAsText(file);
                event.target.value = ''; // ê°™ì€ íŒŒì¼ ë‹¤ì‹œ ì˜¬ë¦´ ìˆ˜ ìˆë„ë¡ ì´ˆê¸°í™”
            }

            // --- ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì • ---

            // íƒ­ ë²„íŠ¼
            document.querySelectorAll(".tab-button").forEach(button => {
                button.addEventListener("click", () => {
                    currentGrade = button.dataset.grade;
                    updateActiveTab();
                    loadGradeBlocks(currentGrade);
                    localStorage.setItem("lastGrade", currentGrade);
                });
            });

            // ìŠ¤í¬ë¡¤ ë²„íŠ¼
            document.getElementById('scrollTop').addEventListener('click', () => window.scrollTo({ top: 0, behavior: 'smooth' }));
            document.getElementById('scrollBottom').addEventListener('click', () => window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' }));

            // ê¸°ëŠ¥ ë²„íŠ¼
            document.getElementById("addBlock").addEventListener("click", () => addBlock());
            document.getElementById("indexShortcut").addEventListener("click", () => document.querySelector('.index-container').scrollIntoView({ behavior: 'smooth' }));
            document.getElementById("downloadData").addEventListener("click", downloadData);
            document.getElementById("uploadDataBtn").addEventListener("click", () => document.getElementById('fileInput').click());
            document.getElementById('fileInput').addEventListener('change', uploadData);

            // ì‚­ì œ ëª¨ë‹¬
            confirmDeleteBtn.addEventListener('click', () => {
                if (blockToDelete) {
                    blockToDelete.remove();
                    saveBlocksToLocalStorage();
                }
                deleteModal.classList.add('hidden');
                blockToDelete = null;
            });
            cancelDeleteBtn.addEventListener('click', () => {
                deleteModal.classList.add('hidden');
                blockToDelete = null;
            });

            // ì„ íƒëœ í…ìŠ¤íŠ¸ ë°”ì´íŠ¸ ê³„ì‚°
            document.addEventListener('selectionchange', () => {
                const selection = window.getSelection();
                if (selection.rangeCount > 0) {
                    const selectedText = selection.toString();
                    const charCount = new Blob([selectedText]).size;
                    selectionInfoEl.textContent = `ì„ íƒí•œ ê¸€ì ë°”ì´íŠ¸ ìˆ˜: ${charCount}`;
                }
            });

            // --- ì´ˆê¸°í™” ---
            loadBlocksFromLocalStorage();
        });
    </script>
</body>
</html>
